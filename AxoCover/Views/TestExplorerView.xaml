<UserControl x:Class="AxoCover.Views.TestExplorerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewModels="clr-namespace:AxoCover.ViewModels"
             xmlns:controls="clr-namespace:AxoCover.Controls"
             xmlns:win="clr-namespace:System.Windows;assembly=PresentationFramework"
             xmlns:res="clr-namespace:AxoCover"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
  <UserControl.Resources>
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Style.xaml" />
      </ResourceDictionary.MergedDictionaries>
      <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </ResourceDictionary>
  </UserControl.Resources>
  <UserControl.Style>
    <win:StaticResource ResourceKey="VSUserControlStyle"/>
  </UserControl.Style>

  <DockPanel>
    <controls:ToolBar DockPanel.Dock="Top" Visibility="{Binding IsSolutionLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
      <controls:ToolBarButton Icon="/AxoCover;component/Resources/expand.png" Command="{Binding ExpandAllCommand}"/>
      <controls:ToolBarButton Icon="/AxoCover;component/Resources/collapse.png" Command="{Binding CollapseAllCommand}"/>
      <controls:ToolBarButton Text="{x:Static res:Resources.Refresh}" Icon="/AxoCover;component/Resources/refresh.png" Command="{Binding BuildCommand}"/>
      <controls:ToolBarButton Text="{x:Static res:Resources.RunTests}" Icon="/AxoCover;component/Resources/test.png" Command="{Binding RunTestsCommand}"/>
      <controls:ToolBarButton Text="{x:Static res:Resources.AutoCover}" Icon="/AxoCover;component/Resources/autocover.png" IsToggle="True" IsChecked="{Binding IsAutoCoverEnabled}" IsEnabled="{Binding IsTestSelected}"/>
      <controls:ToolBarButton Text="{x:Static res:Resources.ShowCoverage}" Icon="/AxoCover;component/Resources/highlight.png" IsToggle="True" IsChecked="{Binding IsHighlighting}"/>
    </controls:ToolBar>

    <Grid DockPanel.Dock="Bottom">
      <Grid.RowDefinitions>
        <RowDefinition />
        <RowDefinition />
      </Grid.RowDefinitions>
      <TextBlock Margin="3" Text="{Binding StatusMessage}"/>
      <ProgressBar x:Name="_progressBar" Grid.Row="1" VerticalAlignment="Bottom" Height="3" Background="Transparent" BorderThickness="0" 
                   IsIndeterminate="{Binding IsProgressIndeterminate}"
                   Value="{Binding Progress}" Maximum="1"
                   Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
    
    <TreeView x:Name="_testTreeView" Background="Transparent" BorderThickness="0"
              ItemsSource="{Binding TestSolution.Children}" SelectedItemChanged="OnSelectedItemChanged">
      <TreeView.ItemTemplate>
        <HierarchicalDataTemplate DataType="{x:Type viewModels:TestItemViewModel}" ItemsSource="{Binding Children}">          
          <DockPanel Margin="1,3">
            <Image x:Name="_icon" DockPanel.Dock="Left" Margin="0,0,3,0"/>
            <TextBlock x:Name="_testCount" DockPanel.Dock="Right" Text="{Binding TestItem.TestCount, StringFormat={}({0})}" Margin="3,0,0,0"/>
            <TextBlock Text="{Binding TestItem.Name}"/>
          </DockPanel>
          <HierarchicalDataTemplate.Triggers>
            <DataTrigger Binding="{Binding TestItem.Kind}" Value="Method">
              <Setter TargetName="_testCount" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding TestItem.Kind}" Value="Project">
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/project.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding TestItem.Kind}" Value="Namespace">
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/namespace.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding TestItem.Kind}" Value="Class">
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/class.png"/>
            </DataTrigger>            
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Unknown"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/test.png"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Passed"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/passed.png"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Failed"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/failed.png"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Error"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/error.png"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Inconclusive"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/inconclusive.png"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
              <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding TestItem.Kind}" Value="Method"/>
                <Condition Binding="{Binding State}" Value="Scheduled"/>
              </MultiDataTrigger.Conditions>
              <Setter TargetName="_icon" Property="Source" Value="/AxoCover;component/Resources/scheduled.png"/>
            </MultiDataTrigger>
          </HierarchicalDataTemplate.Triggers>
        </HierarchicalDataTemplate>
      </TreeView.ItemTemplate>
      <TreeView.ItemContainerStyle>
        <Style TargetType="TreeViewItem" BasedOn="{StaticResource {x:Type TreeViewItem}}">
          <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
        </Style>
      </TreeView.ItemContainerStyle>
    </TreeView>
  </DockPanel>
</UserControl>
